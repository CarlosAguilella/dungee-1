<!DOCTYPE html>

<nav>
    <span class="separador"></span>
    <a href="">Proyecto Dungee</a>
    <a href="start">Start new game</a>
    <a href="play">Play an existing game</a>    
</nav>


<div style="display: flex;">
    <div id="lodearriba">
        <h1>START</h1>
        <nav>
            <button onclick="generarPin()">Start</button>
            <button onclick="obtenerPreguntas()" >Generar preguntas</button>  
    
        </nav>
        <p id="pinEl"></p>
        <p id="userEl"></p>
    </div>
</div>

<div id="preEl"></div>

  

<script>
    let pin;
    let obtenerUsuarioInterval;


    function generarPin (){
        pin = Math.floor(Math.random()*10000);
        pinEl.innerText = pin;
        obtenerUsuarioInterval  =  setInterval(obtenerUsuario, 3000);       
    }    

    function obtenerUsuario (){
        fetch(`/api/damelosuser?pin=${pin}`)
        .then(datos => datos.json())
        .then(json => {
            
            let lista = "";

            for (const user in json.users) {
                lista += json.users[user].name + " ";
            }

            userEl.innerText = lista;
        });
    }    

    function obtenerPreguntas() {
        ocultarCosas();
        clearInterval(obtenerUsuarioInterval);

        fetch(`/api/damelaspreguntas`)
            .then(datos => datos.json())
            .then(json => {
                let preguntas = "";
                let i = 0;

                for (const pregunta in json.preguntas) {
                    preguntas += `<div id='pregunta${i}' class = 'oculto'>`;
                    preguntas += "<h1>" + json.preguntas[pregunta].pregunta +  "</h1>" // Indicamos la "ruta" del json /questions/preguntas/pregunta/pregunta
                    preguntas += "<ul>";
                    preguntas += "<li>"+json.preguntas[pregunta].Res1       // Recorriendo cada uno de los elementos del json.
                    preguntas += "<li>"+json.preguntas[pregunta].Res2       // <li> no hace falta cerrarlo   
                    preguntas += "<li>"+json.preguntas[pregunta].Res3
                    preguntas += "<li>"+json.preguntas[pregunta].Corr
                    preguntas += "</ul>";
                    preguntas += "</div>";
                    i++;
                }
                
                preEl.innerHTML = preguntas;

                irMostrandoPreguntas(i-1);
            });
    }
    
    function irMostrandoPreguntas(cantidad) {
        let i = 0;

        fetch(`https://dungee-431f9-default-rtdb.europe-west1.firebasedatabase.app/pins/pin${pin}`, {
            method: 'POST',
            body: `{"pregunta": ${i}}`
        });

        document.getElementById(`pregunta${i}`).classList.toggle("oculto");


        
        let irMostrandoPreguntasInterval =  setInterval(() =>{
            document.getElementById(`pregunta${i}`).classList.toggle("oculto");
            i++;
            fetch(`https://dungee-431f9-default-rtdb.europe-west1.firebasedatabase.app/pins/pin${pin}`, {
                method: 'POST',
                body: `{"pregunta": ${i}}`
            });
            document.getElementById(`pregunta${i}`).classList.toggle("oculto");
            
            if (i == cantidad) {
                clearInterval(irMostrandoPreguntasInterval);
            }
        }, 1500);
    }

    //Aqui va ocultar cosas 

    function ocultarCosas () {


        lodearriba.classList.toggle("oculto");
    }

</script>


<style>
    nav {
        display: flex;
        gap: 1em;
        padding: 22px;
        background: linear-gradient(90deg, hsl(160, 75%, 51%), hsl(204, 49%, 22%));
        color: white;
    }

    nav span.separador {
        width: 2px;
        background: linear-gradient(90deg, hsl(0, 44%, 28%), hsl(204, 49%, 22%));
    }    


    .oculto{
        display: none;
    }

    

</style>